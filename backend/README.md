# Tourism Backend API

Backend API –¥–ª—è —Ç—É—Ä–∏—Å—Ç–∏—á–µ—Å–∫–æ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è —Å –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–µ–π OBS API.

## –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

- üîê JWT –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è
- üè® –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç—É—Ä–∞–º–∏ –∏ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è–º–∏
- üîÑ –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Å OBS API
- üë§ –õ–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- üìä –ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
- üîî –°–∏—Å—Ç–µ–º–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
- ‚ù§Ô∏è –ò–∑–±—Ä–∞–Ω–Ω—ã–µ —Ç—É—Ä—ã

## –¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏

- Ruby 3.4.5
- Rails 8.0
- PostgreSQL
- JWT –¥–ª—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
- HTTP gem –¥–ª—è API –∑–∞–ø—Ä–æ—Å–æ–≤

## –£—Å—Ç–∞–Ω–æ–≤–∫–∞

1. –ö–ª–æ–Ω–∏—Ä—É–π—Ç–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π
2. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:
   ```bash
   bundle install
   ```

3. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö:
   ```bash
   rails db:create
   rails db:migrate
   rails db:seed
   ```

4. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è (—Å–º. OBS_SETUP.md)

5. –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å–µ—Ä–≤–µ—Ä:
   ```bash
   rails server
   ```

## API Endpoints

### –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è
- `POST /api/v1/auth/register` - –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è
- `POST /api/v1/auth/login` - –í—Ö–æ–¥
- `GET /api/v1/auth/me` - –¢–µ–∫—É—â–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å

### –¢—É—Ä—ã
- `GET /api/v1/tours` - –°–ø–∏—Å–æ–∫ —Ç—É—Ä–æ–≤
- `GET /api/v1/tours/:id` - –î–µ—Ç–∞–ª–∏ —Ç—É—Ä–∞
- `POST /api/v1/tours` - –°–æ–∑–¥–∞—Ç—å —Ç—É—Ä (admin)
- `PUT /api/v1/tours/:id` - –û–±–Ω–æ–≤–∏—Ç—å —Ç—É—Ä (admin)
- `DELETE /api/v1/tours/:id` - –£–¥–∞–ª–∏—Ç—å —Ç—É—Ä (admin)

### –ë—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è
- `GET /api/v1/bookings` - –ú–æ–∏ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è
- `GET /api/v1/bookings/:id` - –î–µ—Ç–∞–ª–∏ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è
- `POST /api/v1/bookings` - –°–æ–∑–¥–∞—Ç—å –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ
- `PUT /api/v1/bookings/:id` - –û–±–Ω–æ–≤–∏—Ç—å –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ
- `DELETE /api/v1/bookings/:id` - –û—Ç–º–µ–Ω–∏—Ç—å –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ

### OBS API Integration
- `GET /api/v1/obs/tours` - –¢—É—Ä—ã –∏–∑ OBS
- `GET /api/v1/obs/tours/:id` - –î–µ—Ç–∞–ª–∏ —Ç—É—Ä–∞ –∏–∑ OBS
- `GET /api/v1/obs/tours/search` - –ü–æ–∏—Å–∫ —Ç—É—Ä–æ–≤ –≤ OBS
- `GET /api/v1/obs/tours/featured` - –ü–æ–ø—É–ª—è—Ä–Ω—ã–µ —Ç—É—Ä—ã OBS
- `GET /api/v1/obs/tours/categories` - –ö–∞—Ç–µ–≥–æ—Ä–∏–∏ OBS
- `POST /api/v1/obs/bookings` - –ë—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —á–µ—Ä–µ–∑ OBS

### –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è
- `GET /api/v1/sync/status` - –°—Ç–∞—Ç—É—Å —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏
- `POST /api/v1/sync/tours` - –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Ç—É—Ä–æ–≤
- `POST /api/v1/sync/all` - –ü–æ–ª–Ω–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è

### –õ–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç
- `GET /api/v1/dashboard` - –ì–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞
- `GET /api/v1/dashboard/stats` - –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
- `PATCH /api/v1/dashboard/profile` - –û–±–Ω–æ–≤–∏—Ç—å –ø—Ä–æ—Ñ–∏–ª—å
- `GET /api/v1/dashboard/notifications` - –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
- `GET /api/v1/dashboard/favorites` - –ò–∑–±—Ä–∞–Ω–Ω—ã–µ —Ç—É—Ä—ã
- `POST /api/v1/dashboard/favorites/:tour_id` - –î–æ–±–∞–≤–∏—Ç—å –≤ –∏–∑–±—Ä–∞–Ω–Ω–æ–µ
- `DELETE /api/v1/dashboard/favorites/:tour_id` - –£–¥–∞–ª–∏—Ç—å –∏–∑ –∏–∑–±—Ä–∞–Ω–Ω–æ–≥–æ

## –ö–æ–º–∞–Ω–¥—ã –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏

### –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Å OBS
```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å OBS API
rails obs:status

# –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Ç—É—Ä—ã
rails obs:sync_tours

# –ü–æ–ª–Ω–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è
rails obs:sync_all

# –û—á–∏—Å—Ç–∏—Ç—å –∫—ç—à –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
rails obs:clear_auth_cache
```

### –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
```bash
# –ó–∞–ø—É—Å—Ç–∏—Ç—å —Ç–µ—Å—Ç—ã
rails test

# –¢–µ—Å—Ç—ã —Å –ø–æ–∫—Ä—ã—Ç–∏–µ–º
rails test:coverage
```

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
app/
‚îú‚îÄ‚îÄ controllers/
‚îÇ   ‚îî‚îÄ‚îÄ api/v1/
‚îÇ       ‚îú‚îÄ‚îÄ auth_controller.rb
‚îÇ       ‚îú‚îÄ‚îÄ tours_controller.rb
‚îÇ       ‚îú‚îÄ‚îÄ bookings_controller.rb
‚îÇ       ‚îú‚îÄ‚îÄ obs_controller.rb
‚îÇ       ‚îú‚îÄ‚îÄ sync_controller.rb
‚îÇ       ‚îî‚îÄ‚îÄ dashboard_controller.rb
‚îú‚îÄ‚îÄ models/
‚îÇ   ‚îú‚îÄ‚îÄ user.rb
‚îÇ   ‚îú‚îÄ‚îÄ tour.rb
‚îÇ   ‚îú‚îÄ‚îÄ booking.rb
‚îÇ   ‚îú‚îÄ‚îÄ notification.rb
‚îÇ   ‚îî‚îÄ‚îÄ favorite_tour.rb
‚îú‚îÄ‚îÄ services/
‚îÇ   ‚îú‚îÄ‚îÄ jwt_service.rb
‚îÇ   ‚îî‚îÄ‚îÄ obs_service.rb
‚îî‚îÄ‚îÄ serializers/
    ‚îú‚îÄ‚îÄ user_serializer.rb
    ‚îú‚îÄ‚îÄ tour_serializer.rb
    ‚îî‚îÄ‚îÄ booking_serializer.rb
```

## –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
- `OBS_API_URL` - URL OBS API
- `OBS_API_KEY` - API –∫–ª—é—á OBS
- `OBS_EMAIL` - Email –¥–ª—è OBS
- `OBS_PASSWORD` - –ü–∞—Ä–æ–ª—å –¥–ª—è OBS
- `SECRET_KEY_BASE` - –°–µ–∫—Ä–µ—Ç–Ω—ã–π –∫–ª—é—á Rails
- `DATABASE_URL` - URL –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

### CORS
–ù–∞—Å—Ç—Ä–æ–µ–Ω –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–æ–º –Ω–∞ localhost:3000 –∏ localhost:5173

## –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### –õ–æ–≥–∏
- –í—Å–µ –∑–∞–ø—Ä–æ—Å—ã –∫ OBS API –ª–æ–≥–∏—Ä—É—é—Ç—Å—è
- –û—à–∏–±–∫–∏ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ –∑–∞–ø–∏—Å—ã–≤–∞—é—Ç—Å—è –≤ –ª–æ–≥–∏
- JWT —Ç–æ–∫–µ–Ω—ã –ª–æ–≥–∏—Ä—É—é—Ç—Å—è –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏

### –ú–µ—Ç—Ä–∏–∫–∏
- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —Ç—É—Ä–æ–≤
- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–π
- –ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

## –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

- JWT —Ç–æ–∫–µ–Ω—ã —Å –∏—Å—Ç–µ—á–µ–Ω–∏–µ–º —Å—Ä–æ–∫–∞ –¥–µ–π—Å—Ç–≤–∏—è
- –í–∞–ª–∏–¥–∞—Ü–∏—è –≤—Å–µ—Ö –≤—Ö–æ–¥—è—â–∏—Ö –¥–∞–Ω–Ω—ã—Ö
- –ó–∞—â–∏—Ç–∞ –æ—Ç CSRF –∞—Ç–∞–∫
- –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –¥–æ—Å—Ç—É–ø–∞ –∫ –∞–¥–º–∏–Ω—Å–∫–∏–º —Ñ—É–Ω–∫—Ü–∏—è–º

## –†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ

### Production
1. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
2. –ó–∞–ø—É—Å—Ç–∏—Ç–µ –º–∏–≥—Ä–∞—Ü–∏–∏: `rails db:migrate`
3. –ü—Ä–µ–¥–∑–∞–≥—Ä—É–∑–∏—Ç–µ –¥–∞–Ω–Ω—ã–µ: `rails db:seed`
4. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ cron –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏
5. –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å–µ—Ä–≤–µ—Ä

### Docker
```bash
docker build -t tourism-backend .
docker run -p 3000:3000 tourism-backend
```

## –ü–æ–¥–¥–µ—Ä–∂–∫–∞

–î–ª—è –≤–æ–ø—Ä–æ—Å–æ–≤ –∏ –ø–æ–¥–¥–µ—Ä–∂–∫–∏ –æ–±—Ä–∞—â–∞–π—Ç–µ—Å—å –∫ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ OBS API –∏–ª–∏ —Å–æ–∑–¥–∞–π—Ç–µ issue –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏.
